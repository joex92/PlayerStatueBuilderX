# PlayerStatueBuilder — Update & Compile for **Minecraft Java 1.21.10**

> Target: a single JAR that runs on **Spigot/Bukkit/Paper/Purpur** (all Java servers except Folia).  
> Build tool: **Maven**.  
> JDK: **21+** (required for MC 1.21+).

---

## 0) Why 1.21.10 matters (and what changed)
- Mojang released **Minecraft Java 1.21.10** (Oct 2025). Spigot/Paper expose this via the **`1.21.10-R0.1-SNAPSHOT`** API.
- **Java 21 is required** to run 1.21.x servers. Compiling with 21 avoids classfile mismatch and lets you use modern APIs.
- Paper now ships a **Mojang-mapped runtime** (since 1.20.5), but your plugin built against Spigot mappings is auto-remapped at load—no special changes needed.

---

## 1) What you have now (from your files)
- `pom.xml` currently:
  - Uses **Spigot API 1.20.1** as `provided`.
  - Shaded **bStats 1.x** (via relocation), Java **17** source/target, and copies `*.yml`/`*.png` resources.  (See chat for inline citations)
- `dependency-reduced-pom.xml` mirrors that and pins PlotSquared 7.3.x as `provided`.  (See chat for inline citations)
- `plugin.yml` currently has:
  - `api-version: 1.20`
  - `version: 1.17`

---

## 2) Goal state (summary)
- **Bump** Spigot API to `1.21.10-R0.1-SNAPSHOT` (still `provided` scope).
- **Bump** `api-version` in `plugin.yml` to `1.21` and set a new plugin version (e.g., `1.18`).
- **Use Java 21** in Maven compiler config.
- **Update bStats** to `3.1.0` (optional but recommended). Keep shading to avoid classpath conflicts.
- **Keep optional hooks** (`Vault`, `WorldGuard`, `PlotSquared`) as `provided` so the JAR runs on servers without them.
- No NMS/CraftBukkit code is present in this project, so **One JAR** for all Java servers is achievable. (Folia excluded—different scheduler/threading model.)

---

## 3) Exact edits — copy/paste diffs

### 3.1 `pom.xml`
Locate your `<dependencies>` block and change the Spigot API dependency to **1.21.10**:

```xml
<dependency>
  <groupId>org.spigotmc</groupId>
  <artifactId>spigot-api</artifactId>
  <version>1.21.10-R0.1-SNAPSHOT</version>
  <scope>provided</scope>
</dependency>
```

**Update bStats (optional/recommended):**
```xml
<dependency>
  <groupId>org.bstats</groupId>
  <artifactId>bstats-bukkit</artifactId>
  <version>3.1.0</version>
  <scope>compile</scope>
</dependency>
```
> Keep the **maven-shade-plugin** relocation for `org.bstats` to your package so metrics never clash.

**Use Java 21** — add/replace the compiler plugin (or set properties) like this:

```xml
<properties>
  <maven.compiler.release>21</maven.compiler.release>
  <maven.compiler.source>21</maven.compiler.source>
  <maven.compiler.target>21</maven.compiler.target>
</properties>

<build>
  <plugins>
    <plugin>
      <groupId>org.apache.maven.plugins</groupId>
      <artifactId>maven-compiler-plugin</artifactId>
      <version>3.11.0</version>
      <configuration>
        <release>21</release>
      </configuration>
    </plugin>

    <!-- keep your existing maven-resources-plugin and maven-shade-plugin blocks -->
  </plugins>
</build>
```

**Repositories** — you already have these; keep them (Spigot snapshots & Paper maven are needed for 1.21.10 artifacts).

### 3.2 `plugin.yml`
Update metadata to the new API level and bump your plugin version:

```yml
name: PlayerStatueBuilderX
main: com.skytechbytes.playerstatuebuilder.PlayerStatueBuilder
version: 1.18
author: SkyTechBytes
softdepend: [WorldGuard, Vault, PlotSquared]
api-version: "1.21"
commands:
  statue:
    description: Make a player statue based on a certain model and in a certain orientation
    usage: /statue <Username> [glass|concrete|terracotta|plank...ht_arm] [hue:<0-1>] [quote] [converter:<rgb|lab|absrgb|hsl|hsb>]
  undostatue:
    description: Undo the last statue created by ANYONE on the server
    usage: /undostatue
permissions:
  # (keep your existing permission nodes unchanged)
```

### 3.3 `dependency-reduced-pom.xml`
You **don’t need to hand-edit** this file; it is generated by the Shade plugin. It will refresh on the next `mvn package`. If you must check it in, delete it and let Maven regenerate.

---

## 4) Compile & verify

### 4.1 Clean build
```bash
# From project root
mvn -U -e -X clean package -DskipTests
```
- `-U` ensures snapshots (like `1.21.10-R0.1-SNAPSHOT`) are refreshed.
- `-e -X` prints full stacktraces and debug logs if anything fails.

### 4.2 Inspect the fat JAR
```bash
# See that classes + resources + shaded bStats exist
jar tf target/PlayerStatueBuilderXv*.jar | head -n 50
```

### 4.3 Local test on each server type
1. **Spigot**: drop the JAR in `plugins/`, start a **1.21.10** server.
2. **Paper** or **Purpur**: same steps; first run may show *“remapping plugin”* (normal on Paper 1.20.5+).
3. **Bukkit** (legacy): use a 1.21.10-compatible build (rare). Prefer Spigot or Paper in practice.

Run basic smoke tests:
```txt
/version
/plugins
/statue YourName
/undostatue
```

---

## 5) Debugging playbook

### Dependency resolution
```bash
mvn -Dverbose dependency:tree
mvn help:effective-pom | sed -n '1,200p'
```

### Snapshot cache issues
```bash
rm -rf ~/.m2/repository/org/spigotmc/spigot-api
mvn -U clean package
```

### Java version mismatch
- **Server refuses to start or plugin fails to load with 'Unsupported class file major version'** → you compiled with 21 but the server is on an older JVM. **Fix**: run the server with Java 21 (or recompile with 21 and run server with 21—recommended).
- Verify with:
```bash
java -version
```

### Missing optional deps at runtime
- If WorldGuard/PlotSquared/Vault aren’t installed, your plugin should still load (they’re `softdepend`). Use `Bukkit.getPluginManager().getPlugin("WorldGuard") != null` checks before calling their APIs.

### Metrics not found
- `NoClassDefFoundError: org/bstats/bukkit/Metrics` → you either removed the dependency or didn’t shade it. Keep `bstats-bukkit` on `compile` scope **and** keep the shade relocation.

---

## 6) “One JAR to rule them all” — yes (with one caveat)

- Build **against Spigot API**, avoid imports from Paper-only APIs. Your current codebase already follows this. The resulting JAR runs on **Spigot, Paper, Purpur, and most Bukkit-compatible servers**.
- **Folia** is different: region-threading + FoliaScheduler. Unless you add Folia-specific scheduling guards, compatibility is **not guaranteed**. If you want Folia support later, wrap all world access in Folia-safe tasks and guard any synchronous Bukkit calls.

---

## 7) Future updates checklist (copy/paste for 1.21.x → 1.22+)

1. **Change only two things first:**
   - `spigot-api` version → bump to the next `x.y.z-R0.1-SNAPSHOT`.
   - `api-version` in `plugin.yml` → bump to the new major (e.g., `"1.22"`).
2. **Rebuild with Java LTS required by Mojang/Paper** (check release notes; for 1.21.x that is Java 21).
3. **Run `mvn -U clean package`** and test on Spigot + Paper.
4. **Scan for deprecations** in the Spigot Javadocs for that version and adjust.
5. If you ever add Paper-only utilities, gate them behind reflection or a **soft** runtime check so the JAR still loads on Spigot.

---

## 8) Full, ready-to-use `pom.xml` (minimally edited)

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>com.skytechbytes</groupId>
  <artifactId>playerstatuebuilder</artifactId>
  <version>1.18</version>

  <properties>
    <maven.compiler.release>21</maven.compiler.release>
    <maven.compiler.source>21</maven.compiler.source>
    <maven.compiler.target>21</maven.compiler.target>
  </properties>

  <build>
    <finalName>PlayerStatueBuilderXv${project.version}-SkyTechBytes</finalName>
    <sourceDirectory>src</sourceDirectory>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>3.11.0</version>
        <configuration>
          <release>21</release>
        </configuration>
      </plugin>

      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-resources-plugin</artifactId>
        <version>3.2.0</version>
        <executions>
          <execution>
            <id>copy-resources</id>
            <phase>compile</phase>
            <goals><goal>copy-resources</goal></goals>
            <configuration>
              <outputDirectory>${project.build.directory}/classes</outputDirectory>
              <resources>
                <resource>
                  <directory>src</directory>
                  <includes>
                    <include>**/*.png</include>
                    <include>**/*.yml</include>
                  </includes>
                </resource>
              </resources>
            </configuration>
          </execution>
        </executions>
      </plugin>

      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-shade-plugin</artifactId>
        <version>3.5.1</version>
        <configuration>
          <relocations>
            <relocation>
              <pattern>org.bstats</pattern>
              <shadedPattern>com.skytechbytes.playerstatuebuilder.libs.bstats</shadedPattern>
            </relocation>
          </relocations>
        </configuration>
        <executions>
          <execution>
            <phase>package</phase>
            <goals><goal>shade</goal></goals>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>

  <repositories>
    <repository>
      <id>spigotmc-repo</id>
      <url>https://hub.spigotmc.org/nexus/content/repositories/snapshots/</url>
    </repository>
    <repository>
      <id>papermc</id>
      <url>https://repo.papermc.io/repository/maven-public/</url>
    </repository>
    <repository>
      <id>jitpack.io</id>
      <url>https://jitpack.io</url>
    </repository>
    <repository>
      <id>sk89q-repo</id>
      <url>https://maven.enginehub.org/repo/</url>
    </repository>
    <repository>
      <id>CodeMC</id>
      <url>https://repo.codemc.org/repository/maven-public</url>
    </repository>
  </repositories>

  <dependencies>
    <!-- Base API for widest compatibility -->
    <dependency>
      <groupId>org.spigotmc</groupId>
      <artifactId>spigot-api</artifactId>
      <version>1.21.10-R0.1-SNAPSHOT</version>
      <scope>provided</scope>
    </dependency>

    <!-- Optional hooks (soft depends at runtime) -->
    <dependency>
      <groupId>com.github.MilkBowl</groupId>
      <artifactId>VaultAPI</artifactId>
      <version>1.7</version>
      <scope>provided</scope>
    </dependency>

    <dependency>
      <groupId>com.sk89q.worldguard</groupId>
      <artifactId>worldguard-bukkit</artifactId>
      <version>7.0.14</version>
      <scope>provided</scope>
      <exclusions>
        <exclusion><groupId>org.bukkit</groupId><artifactId>bukkit</artifactId></exclusion>
        <exclusion><groupId>com.sk89q</groupId><artifactId>commandbook</artifactId></exclusion>
        <exclusion><groupId>org.bstats</groupId><artifactId>bstats-bukkit</artifactId></exclusion>
      </exclusions>
    </dependency>

    <dependency>
      <groupId>com.intellectualsites.plotsquared</groupId>
      <artifactId>plotsquared-core</artifactId>
      <version>7.3.0</version>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>com.intellectualsites.plotsquared</groupId>
      <artifactId>plotsquared-bukkit</artifactId>
      <version>7.3.0</version>
      <scope>provided</scope>
      <exclusions>
        <exclusion><groupId>*</groupId><artifactId>plotsquared-core</artifactId></exclusion>
      </exclusions>
    </dependency>

    <!-- Your image filter library -->
    <dependency>
      <groupId>com.jhlabs</groupId>
      <artifactId>filters</artifactId>
      <version>2.0.235-1</version>
    </dependency>

    <!-- Metrics -->
    <dependency>
      <groupId>org.bstats</groupId>
      <artifactId>bstats-bukkit</artifactId>
      <version>3.1.0</version>
      <scope>compile</scope>
    </dependency>
  </dependencies>
</project>
```

> Notes:
> - The **WorldGuard** version here matches their MC 1.21.5–1.21.10 release.
> - Keeping **Spigot API** as your only compile-time server API guarantees maximum compatibility. Paper/Purpur users get extra performance transparently.

---

## 9) Release checklist
- [ ] `mvn -U clean package`
- [ ] Upload JAR to a clean server and verify `/plugins` → **enabled**
- [ ] Exercise commands and permissions
- [ ] Tag your Git release `v1.18` (or similar) with changelog “MC 1.21.10 compatibility”.

Happy building! :)
